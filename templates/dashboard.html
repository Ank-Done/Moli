{% extends "base.html" %}

{% block title %}Dashboard - Sistema Cyberia{% endblock %}

{% block page_title %}Dashboard Ejecutivo{% endblock %}

{% block content %}
<!-- Métricas Principales -->
<div class="metrics-grid" id="metricsGrid">
    <!-- Las métricas se cargarán dinámicamente aquí -->
</div>

<!-- Gráficos y Análisis -->
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 32px;">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 010 5.814 3.75 3.75 0 01-5.596 2.058l-6.46-6.46 3.536-3.536L12 8.25l-4.5 4.5 4.5 4.5 2.25-2.25z"/>
                </svg>
                Tendencia de Ventas Mensuales
            </h3>
        </div>
        <div class="chart-container">
            <canvas id="monthlySalesChart"></canvas>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 107.5 7.5h-7.5V6z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0013.5 3v7.5z"/>
                </svg>
                Distribución por Tipo
            </h3>
        </div>
        <div class="chart-container">
            <canvas id="salesByTypeChart"></canvas>
        </div>
    </div>
</div>

<!-- Top Performers -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px;">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 01-.982-3.172M9.497 14.25a7.454 7.454 0 00.981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 007.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.545.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 002.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.228a25.18 25.18 0 012.16.47m-2.16-.47a25.18 25.18 0 00-2.16.47m0 0a6.726 6.726 0 01-2.748 1.35m0 0a6.772 6.772 0 01-3.044 0"/>
                </svg>
                Top Agentes de Ventas
            </h3>
        </div>
        <div id="topAgents">
            <!-- Los agentes se cargarán aquí -->
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.562.562 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"/>
                </svg>
                Productos Estrella
            </h3>
        </div>
        <div id="topProducts">
            <!-- Los productos se cargarán aquí -->
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/>
                </svg>
                Productos con Bajo Rendimiento
            </h3>
        </div>
        <div id="worstProducts">
            <!-- Los productos con bajo rendimiento se cargarán aquí -->
        </div>
    </div>
</div>

{% endblock %}

{% block sidebar %}
<div class="sidebar-section">
    <div class="sidebar-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"/>
        </svg>
        Estado del Sistema
    </div>
    <div id="systemStatus">
        <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <div style="width: 8px; height: 8px; background-color: var(--text-success); border-radius: 50%; margin-right: 8px;"></div>
            <span style="font-size: var(--font-size-small);">Base de datos conectada</span>
        </div>
        <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <div style="width: 8px; height: 8px; background-color: var(--text-success); border-radius: 50%; margin-right: 8px;"></div>
            <span style="font-size: var(--font-size-small);">API funcionando</span>
        </div>
        <div style="display: flex; align-items: center;">
            <div id="lastUpdate" style="width: 8px; height: 8px; background-color: var(--text-warning); border-radius: 50%; margin-right: 8px;"></div>
            <span style="font-size: var(--font-size-small);" id="lastUpdateText">Actualizando...</span>
        </div>
    </div>
</div>

<div class="sidebar-section">
    <div class="sidebar-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"/>
        </svg>
        Métricas Rápidas
    </div>
    <div id="quickMetrics">
        <!-- Métricas rápidas se cargarán aquí -->
    </div>
</div>

<div class="sidebar-section">
    <div class="sidebar-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        Acciones Rápidas
    </div>
    <div style="display: flex; flex-direction: column; gap: 8px;">
        <a href="/products" class="btn" style="justify-content: flex-start;">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
            </svg>
            Nuevo Producto
        </a>
        <a href="/sales" class="btn" style="justify-content: flex-start;">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m6.75 12l-3-3m0 0l-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/>
            </svg>
            Nueva Venta
        </a>
        <a href="/analytics" class="btn" style="justify-content: flex-start;">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/>
            </svg>
            Ver Reportes
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let monthlySalesChart, salesByTypeChart;

// Dashboard API service
const dashboardService = {
    async getMetrics() {
        return await apiService.get('/api/analytics/dashboard-metrics');
    }
};

// Initialize dashboard
async function initDashboard() {
    try {
        const metrics = await dashboardService.getMetrics();
        renderMetrics(metrics);
        renderCharts(metrics);
        renderTopPerformers(metrics);
        renderQuickMetrics(metrics);
        updateLastUpdateTime();
        
        utils.showToast('Dashboard cargado exitosamente', 'success');
    } catch (error) {
        console.error('Error loading dashboard:', error);
        utils.showToast('Error al cargar el dashboard', 'error');
        updateSystemStatus(false);
    }
}

// Render key metrics with Obsidian-style cards
function renderMetrics(data) {
    const metricsGrid = document.getElementById('metricsGrid');
    
    const metricsHtml = `
        <div class="metric-card" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
            <div class="metric-label">Ventas Mes Actual</div>
            <div class="metric-value">${data.current_month_sales}</div>
            <div class="metric-change">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="${data.sales_change_pct >= 0 ? 'M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 010 5.814 3.75 3.75 0 01-5.596 2.058' : 'M2.25 6L9 12.75l4.306-4.307a11.95 11.95 0 015.814 0 3.75 3.75 0 01-1.232 6.832'}" />
                </svg>
                ${data.sales_change_pct ? Math.abs(data.sales_change_pct).toFixed(1) + '%' : 'N/A'} vs mes anterior
            </div>
        </div>
        
        <div class="metric-card" style="background: linear-gradient(135deg, #ec4899, #f97316);">
            <div class="metric-label">Órdenes Mes Actual</div>
            <div class="metric-value">${utils.formatNumber(data.current_month_orders)}</div>
            <div class="metric-change">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="${data.orders_change_pct >= 0 ? 'M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 010 5.814 3.75 3.75 0 01-5.596 2.058' : 'M2.25 6L9 12.75l4.306-4.307a11.95 11.95 0 015.814 0 3.75 3.75 0 01-1.232 6.832'}" />
                </svg>
                ${data.orders_change_pct ? Math.abs(data.orders_change_pct).toFixed(1) + '%' : 'N/A'} vs mes anterior
            </div>
        </div>
        
        <div class="metric-card" style="background: linear-gradient(135deg, #06b6d4, #3b82f6);">
            <div class="metric-label">Ventas Año a la Fecha</div>
            <div class="metric-value">${data.ytd_sales}</div>
            <div class="metric-change">Total acumulado ${new Date().getFullYear()}</div>
        </div>
        
        <div class="metric-card" style="background: linear-gradient(135deg, #10b981, #059669);">
            <div class="metric-label">Orden Promedio</div>
            <div class="metric-value">$${utils.formatNumber(data.current_avg_order)}</div>
            <div class="metric-change">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="${data.avg_order_change_pct >= 0 ? 'M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 010 5.814 3.75 3.75 0 01-5.596 2.058' : 'M2.25 6L9 12.75l4.306-4.307a11.95 11.95 0 015.814 0 3.75 3.75 0 01-1.232 6.832'}" />
                </svg>
                ${data.avg_order_change_pct ? Math.abs(data.avg_order_change_pct).toFixed(1) + '%' : 'N/A'} vs mes anterior
            </div>
        </div>
    `;
    
    metricsGrid.innerHTML = metricsHtml;
}

// Render charts with improved styling
function renderCharts(data) {
    // Monthly Sales Chart
    const ctxMonthlySales = document.getElementById('monthlySalesChart').getContext('2d');
    
    if (monthlySalesChart) {
        monthlySalesChart.destroy();
    }
    
    monthlySalesChart = new Chart(ctxMonthlySales, {
        type: 'line',
        data: {
            labels: data.monthly_sales.map(item => item.month_name),
            datasets: [{
                label: 'Ventas Mensuales',
                data: data.monthly_sales.map(item => item.total_sales),
                borderColor: '#6366f1',
                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#6366f1',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(15, 23, 42, 0.9)',
                    titleColor: '#f1f5f9',
                    bodyColor: '#f1f5f9',
                    borderColor: '#475569',
                    borderWidth: 1,
                    cornerRadius: 8,
                    callbacks: {
                        label: function(context) {
                            return `Ventas: ${utils.formatCurrency(context.parsed.y)}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(71, 85, 105, 0.1)',
                        borderColor: 'rgba(71, 85, 105, 0.2)'
                    },
                    ticks: {
                        color: '#64748b'
                    }
                },
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(71, 85, 105, 0.1)',
                        borderColor: 'rgba(71, 85, 105, 0.2)'
                    },
                    ticks: {
                        color: '#64748b',
                        callback: function(value) {
                            return utils.formatCurrency(value);
                        }
                    }
                }
            }
        }
    });
    
    // Sales by Type Chart
    const ctxSalesByType = document.getElementById('salesByTypeChart').getContext('2d');
    
    if (salesByTypeChart) {
        salesByTypeChart.destroy();
    }
    
    const colors = [
        '#6366f1',
        '#8b5cf6',
        '#ec4899',
        '#f97316',
        '#06b6d4',
        '#10b981'
    ];
    
    salesByTypeChart = new Chart(ctxSalesByType, {
        type: 'doughnut',
        data: {
            labels: data.sales_by_type.map(item => item.order_type),
            datasets: [{
                data: data.sales_by_type.map(item => item.total_sales),
                backgroundColor: colors,
                borderWidth: 0,
                hoverBorderWidth: 2,
                hoverBorderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true,
                        color: '#64748b'
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(15, 23, 42, 0.9)',
                    titleColor: '#f1f5f9',
                    bodyColor: '#f1f5f9',
                    borderColor: '#475569',
                    borderWidth: 1,
                    cornerRadius: 8,
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: ${utils.formatCurrency(context.parsed)}`;
                        }
                    }
                }
            }
        }
    });
}

// Render top performers with improved styling
function renderTopPerformers(data) {
    // Top Agents
    const topAgentsHtml = data.top_agents.map((agent, index) => `
        <div style="display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--background-modifier-border);">
            <div style="
                width: 32px; 
                height: 32px; 
                background: linear-gradient(135deg, #6366f1, #8b5cf6); 
                color: white; 
                border-radius: 50%; 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                font-weight: var(--font-weight-semibold);
                font-size: var(--font-size-small);
                margin-right: 12px;
            ">${index + 1}</div>
            <div style="flex: 1;">
                <div style="font-weight: var(--font-weight-medium); color: var(--text-normal); margin-bottom: 2px;">
                    ${agent.agent_name}
                </div>
                <div style="font-size: var(--font-size-smaller); color: var(--text-muted);">
                    ${agent.agent_code} • ${agent.total_orders} órdenes
                </div>
            </div>
            <div style="text-align: right;">
                <div style="font-weight: var(--font-weight-semibold); color: var(--text-normal);">
                    ${utils.formatCurrency(agent.total_sales)}
                </div>
            </div>
        </div>
    `).join('');
    
    document.getElementById('topAgents').innerHTML = topAgentsHtml;
    
    // Top Products
    const topProductsHtml = data.top_products.map((product, index) => `
        <div style="display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--background-modifier-border);">
            <div style="
                width: 32px; 
                height: 32px; 
                background: linear-gradient(135deg, #10b981, #059669); 
                color: white; 
                border-radius: 50%; 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                font-weight: var(--font-weight-semibold);
                font-size: var(--font-size-small);
                margin-right: 12px;
            ">${index + 1}</div>
            <div style="flex: 1;">
                <div style="font-weight: var(--font-weight-medium); color: var(--text-normal); margin-bottom: 2px;">
                    ${product.product_name}
                </div>
                <div style="font-size: var(--font-size-smaller); color: var(--text-muted);">
                    <code>${product.product_code}</code> • ${utils.formatNumber(product.total_quantity)} kg
                </div>
            </div>
            <div style="text-align: right;">
                <div style="font-weight: var(--font-weight-semibold); color: var(--text-normal);">
                    ${utils.formatCurrency(product.total_sales)}
                </div>
            </div>
        </div>
    `).join('');
    
    document.getElementById('topProducts').innerHTML = topProductsHtml;
    
    // Worst Products
    const worstProductsHtml = data.worst_products.map((product, index) => `
        <div style="display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--background-modifier-border);">
            <div style="
                width: 32px; 
                height: 32px; 
                background: linear-gradient(135deg, #f59e0b, #d97706); 
                color: white; 
                border-radius: 50%; 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                font-weight: var(--font-weight-semibold);
                font-size: var(--font-size-small);
                margin-right: 12px;
            ">${index + 1}</div>
            <div style="flex: 1;">
                <div style="font-weight: var(--font-weight-medium); color: var(--text-normal); margin-bottom: 2px;">
                    ${product.product_name}
                </div>
                <div style="font-size: var(--font-size-smaller); color: var(--text-muted);">
                    <code>${product.product_code}</code>
                </div>
            </div>
            <div style="text-align: right;">
                <div style="
                    padding: 4px 8px; 
                    background-color: rgba(245, 158, 11, 0.1); 
                    color: var(--text-warning); 
                    border-radius: 6px; 
                    font-size: var(--font-size-smaller);
                    font-weight: var(--font-weight-medium);
                ">
                    ${product.avg_margin.toFixed(1)}% margen
                </div>
            </div>
        </div>
    `).join('');
    
    document.getElementById('worstProducts').innerHTML = worstProductsHtml;
}

// Render quick metrics in sidebar
function renderQuickMetrics(data) {
    const quickMetricsHtml = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 12px; background-color: var(--background-secondary); border-radius: 8px;">
            <div>
                <div style="font-size: var(--font-size-smaller); color: var(--text-muted);">Clientes Activos</div>
                <div style="font-weight: var(--font-weight-semibold); color: var(--text-normal);">${utils.formatNumber(data.total_customers)}</div>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; color: var(--text-accent);">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"/>
            </svg>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 12px; background-color: var(--background-secondary); border-radius: 8px;">
            <div>
                <div style="font-size: var(--font-size-smaller); color: var(--text-muted);">Productos Activos</div>
                <div style="font-weight: var(--font-weight-semibold); color: var(--text-normal);">${utils.formatNumber(data.total_products)}</div>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; color: var(--text-accent);">
                <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"/>
            </svg>
        </div>
    `;
    
    document.getElementById('quickMetrics').innerHTML = quickMetricsHtml;
}

// Update system status
function updateSystemStatus(isHealthy = true) {
    const statusIndicator = document.querySelector('#systemStatus div:first-child div');
    if (statusIndicator) {
        statusIndicator.style.backgroundColor = isHealthy ? 'var(--text-success)' : 'var(--text-error)';
    }
}

// Update last update time
function updateLastUpdateTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('es-MX', { 
        hour: '2-digit', 
        minute: '2-digit' 
    });
    
    document.getElementById('lastUpdateText').textContent = `Última actualización: ${timeString}`;
    document.getElementById('lastUpdate').style.backgroundColor = 'var(--text-success)';
}

// Auto-refresh dashboard every 5 minutes
setInterval(initDashboard, 5 * 60 * 1000);

// Initialize on page load
document.addEventListener('DOMContentLoaded', initDashboard);
</script>
{% endblock %}